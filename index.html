<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Hub</title>
<style>
body { background: #222; color: #fff; font-family: Arial; text-align:center; margin:0; overflow:hidden; }
#menu { margin-top:50px; }
button { padding:15px 30px; margin:10px; font-size:20px; cursor:pointer; }
#gameCanvas { background:black; display:none; margin:20px auto; border:2px solid white; touch-action:none; }
#controls { display:none; margin:20px; }
#overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); color:white; display:none; justify-content:center; align-items:center; flex-direction:column; z-index:10; }
#overlay h2 { font-size:40px; margin-bottom:20px; }
#difficultySelect { margin-top:20px; }
.touch-controls { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); display:none; z-index:20; }
.touch-controls button { padding:20px; margin:5px; font-size:24px; opacity:0.7; }
#snakeSettings { margin-top:20px; display:none; }
</style>
</head>
<body>

<h1>Game Hub</h1>

<div id="menu">
  <button onclick="selectGame('pong')">Play Pong</button>
  <button onclick="selectGame('snake')">Play Snake</button>
  <button onclick="selectGame('space')">Play Space Invaders</button>
  <div id="difficultySelect">
    Difficulty:
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
    </select>
  </div>
</div>

<div id="controls">
  <button onclick="startCurrentGame()">Start</button>
  <button onclick="goBack()">Back</button>
</div>

<div id="snakeSettings">
  <label><input type="checkbox" id="rainbowToggle"> Rainbow Mode</label><br>
  <label><input type="checkbox" id="hunterToggle"> Hunter Mode (2P)</label><br>
  <label>AI Snakes: <span id="aiCountDisplay">1</span></label>
  <button id="aiMinus">-</button>
  <button id="aiPlus">+</button>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="overlay">
  <h2 id="gameOverText">Game Over</h2>
  <p id="finalScore"></p>
  <button onclick="restartGame()">Restart</button>
  <button onclick="exitToMenu()">Return to Menu</button>
</div>

<div class="touch-controls" id="touchControls">
  <button id="btnLeft">◀</button>
  <button id="btnRight">▶</button>
  <button id="btnUp">▲</button>
  <button id="btnDown">▼</button>
  <button id="btnShoot">Fire</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const overlay = document.getElementById('overlay');
const finalScoreText = document.getElementById('finalScore');
const difficultySelect = document.getElementById('difficulty');
const touchControls = document.getElementById('touchControls');
const btnLeft = document.getElementById('btnLeft');
const btnRight = document.getElementById('btnRight');
const btnUp = document.getElementById('btnUp');
const btnDown = document.getElementById('btnDown');
const btnShoot = document.getElementById('btnShoot');

const snakeSettings = document.getElementById('snakeSettings');
const rainbowToggle = document.getElementById('rainbowToggle');
const hunterToggle = document.getElementById('hunterToggle');
const aiCountDisplay = document.getElementById('aiCountDisplay');
const aiMinus = document.getElementById('aiMinus');
const aiPlus = document.getElementById('aiPlus');

let currentGame = null;
let currentGameName = null;

let snakeConfig = { rainbowEnabled:false, hunterMode:false, aiCount:1 };
function updateAICountDisplay(){ aiCountDisplay.innerText = snakeConfig.aiCount; }
aiPlus.onclick = ()=>{ if(snakeConfig.aiCount<50){ snakeConfig.aiCount++; updateAICountDisplay(); } };
aiMinus.onclick = ()=>{ if(snakeConfig.aiCount>0){ snakeConfig.aiCount--; updateAICountDisplay(); } };
rainbowToggle.onchange = ()=>{ snakeConfig.rainbowEnabled = rainbowToggle.checked; };
hunterToggle.onchange = ()=>{ snakeConfig.hunterMode = hunterToggle.checked; };

function selectGame(game){
  document.getElementById('menu').style.display='none';
  document.getElementById('controls').style.display='block';
  canvas.style.display='block';
  currentGameName=game;
  if('ontouchstart' in window){ touchControls.style.display='block'; } else{ touchControls.style.display='none'; }
}

function startCurrentGame(){
  if(currentGame && currentGame.stop) currentGame.stop();
  overlay.style.display='none';
  const difficulty=difficultySelect.value;
  if(currentGameName==='snake'){
    snakeSettings.style.display='block';
    currentGame=SnakeGame(canvas,difficulty,snakeConfig);
    currentGame.start();
  } else {
    snakeSettings.style.display='none';
    if(currentGameName==='pong'){ currentGame=PongGame(canvas,difficulty); currentGame.start(); }
    else if(currentGameName==='space'){ currentGame=SpaceInvadersGame(canvas,difficulty); currentGame.start(); }
  }
}

function goBack(){
  if(currentGame && currentGame.stop) currentGame.stop();
  canvas.style.display='none';
  document.getElementById('controls').style.display='none';
  document.getElementById('menu').style.display='block';
  overlay.style.display='none';
  touchControls.style.display='none';
}

function showGameOver(score){
  overlay.style.display='flex';
  finalScoreText.innerText="Final Score: "+score;
}

function restartGame(){ overlay.style.display='none'; startCurrentGame(); }
function exitToMenu(){ overlay.style.display='none'; goBack(); }

// -------------------- PONG --------------------
function PongGame(canvas,difficulty){ /* keep existing Pong code as before */ return {start,stop}; }

// -------------------- SNAKE --------------------
function SnakeGame(canvas,difficulty,config){
  const ctx=canvas.getContext('2d');
  const WIDTH=canvas.width, HEIGHT=canvas.height;
  const blockSize=20; let frame=0; let animationFrameId; let running=false;
  let playerSnake=[], playerDir={x:blockSize,y:0}; let hunterSnake=[], hunterDir={x:-blockSize,y:0};
  let aiSnakes=[], aiDirs=[], aiColors=[], food={x:0,y:0}; let moveTick=0, score=0;
  let playerMoveDelay=1, aiMoveDelay=2, hunterMoveDelay=1;
  let wallGraceDuration=5, wallGraceActive=false, wallGraceTimer=0;
  let rainbowEnabled=config.rainbowEnabled, hunterMode=config.hunterMode, aiEnabled=config.aiCount>0, aiCount=config.aiCount;

  // adjust speeds by difficulty
  if(difficulty==='easy'){ playerMoveDelay=3; aiMoveDelay=4; hunterMoveDelay=3; }
  else if(difficulty==='medium'){ playerMoveDelay=2; aiMoveDelay=3; hunterMoveDelay=2; }
  else{ playerMoveDelay=1; aiMoveDelay=2; hunterMoveDelay=1; }

  function randomColor(){ return `rgb(${50+Math.floor(Math.random()*205)},${50+Math.floor(Math.random()*205)},${50+Math.floor(Math.random()*205)})`; }
  function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }
  function spawnFood(){ return {x:Math.floor(Math.random()* (WIDTH/blockSize))*blockSize, y:Math.floor(Math.random()*(HEIGHT/blockSize))*blockSize}; }

  function initGame(){
    playerSnake=[{x:100,y:100}]; playerDir={x:blockSize,y:0};
    hunterSnake=hunterMode?[{x:WIDTH-200,y:300}]:[];
    hunterDir={x:-blockSize,y:0};
    aiSnakes=[]; aiDirs=[]; aiColors=[];
    if(aiEnabled) for(let i=0;i<aiCount;i++){
      let sx=WIDTH-200-i*6*blockSize, sy=120+(i*40)%(HEIGHT-160);
      let snake=[]; for(let j=0;j<6;j++) snake.push({x:sx,y:sy-j*blockSize});
      aiSnakes.push(snake); aiDirs.push({x:0,y:blockSize}); aiColors.push(randomColor());
    }
    food=spawnFood(); score=0; moveTick=0; wallGraceActive=false; wallGraceTimer=0;
  }

  function computeInterceptDirection(head,targetHead,targetDir){
    let hx=head.x,hy=head.y,tx=targetHead.x,ty=targetHead.y;
    let manh=Math.abs(hx-tx)+Math.abs(hy-ty);
    let steps=1+Math.floor(manh/(blockSize*4));
    let px=clamp(tx+targetDir.x*steps,0,WIDTH-blockSize);
    let py=clamp(ty+targetDir.y*steps,0,HEIGHT-blockSize);
    let candidates=[{x:blockSize,y:0},{x:-blockSize,y:0},{x:0,y:blockSize},{x:0,y:-blockSize}];
    let scored=candidates.map(d=>({score:Math.abs(hx+d.x-px)+Math.abs(hy+d.y-py),dir:d}));
    if(manh<=6*blockSize){ let pref=targetDir.x!==0?[{x:0,y:blockSize},{x:0,y:-blockSize}]:[{x:blockSize,y:0},{x:-blockSize,y:0}]; scored.sort((a,b)=>pref.includes(a.dir)?-1:1); }
    scored.sort((a,b)=>a.score-b.score);
    return scored[Math.floor(Math.random()*2)].dir;
  }

  function draw(){ ctx.fillStyle='black'; ctx.fillRect(0,0,WIDTH,HEIGHT);
    playerSnake.forEach(seg=>{ ctx.fillStyle=rainbowEnabled?randomColor():'lime'; ctx.fillRect(seg.x,seg.y,blockSize,blockSize); });
    hunterSnake.forEach(seg=>{ ctx.fillStyle='orange'; ctx.fillRect(seg.x,seg.y,blockSize,blockSize); });
    aiSnakes.forEach((s,i)=>{ ctx.fillStyle=aiColors[i]; s.forEach(seg=>ctx.fillRect(seg.x,seg.y,blockSize,blockSize)); });
    ctx.fillStyle='red'; ctx.fillRect(food.x,food.y,blockSize,blockSize);
    ctx.fillStyle='white'; ctx.font='20px Arial'; ctx.fillText('Score: '+score,10,20);
  }

  function update(){
    moveTick++;
    if(moveTick%playerMoveDelay===0){
      let newHead={x:playerSnake[0].x+playerDir.x,y:playerSnake[0].y+playerDir.y};
      if(newHead.x<0||newHead.y<0||newHead.x>=WIDTH||newHead.y>=HEIGHT){ if(!wallGraceActive){ wallGraceActive=true; wallGraceTimer=wallGraceDuration; } }
      else wallGraceActive=false;
      if(wallGraceActive){ wallGraceTimer--; if(wallGraceTimer<=0){ endGame(); return; } }
      playerSnake.unshift(newHead);
      if(newHead.x===food.x && newHead.y===food.y){ score++; food=spawnFood(); } else playerSnake.pop();
      for(let i=1;i<playerSnake.length;i++){ if(playerSnake[i].x===newHead.x && playerSnake[i].y===newHead.y){ endGame(); return; } }
      if(hunterMode) for(let s of hunterSnake){ if(s.x===newHead.x && s.y===newHead.y){ endGame(); return; } }
      for(let s of aiSnakes) for(let seg of s){ if(seg.x===newHead.x && seg.y===newHead.y){ endGame(); return; } }
    }
    if(hunterMode && moveTick%hunterMoveDelay===0){
      let hnew={x:hunterSnake[0].x+hunterDir.x, y:hunterSnake[0].y+hunterDir.y};
      hunterSnake.unshift(hnew); hunterSnake.pop();
      while(hunterSnake.length<playerSnake.length) hunterSnake.push({...hunterSnake[hunterSnake.length-1]});
      while(hunterSnake.length>playerSnake.length) hunterSnake.pop();
    }
    aiSnakes.forEach((s,i)=>{
      if(moveTick%aiMoveDelay===0){
        let newDir=computeInterceptDirection(s[0],playerSnake[0],playerDir); aiDirs[i]=newDir;
        let newHead={x:s[0].x+aiDirs[i].x,y:s[0].y+aiDirs[i].y};
        s.unshift(newHead); if(newHead.x===food.x && newHead.y===food.y){ food=spawnFood(); score++; } else s.pop();
      }
    });
  }

  function gameLoop(){ if(!running) return; update(); draw(); animationFrameId=requestAnimationFrame(gameLoop); }

  function keyHandler(e){
    const k=e.key.toLowerCase();
    if(k==='arrowup'||k==='w'){ if(playerDir.y===0) playerDir={x:0,y:-blockSize}; }
    if(k==='arrowdown'||k==='s'){ if(playerDir.y===0) playerDir={x:0,y:blockSize}; }
    if(k==='arrowleft'||k==='a'){ if(playerDir.x===0) playerDir={x:-blockSize,y:0}; }
    if(k==='arrowright'||k==='d'){ if(playerDir.x===0) playerDir={x:blockSize,y:0}; }
  }

  document.addEventListener('keydown',keyHandler);

  function start(){ running=true; initGame(); gameLoop(); }
  function stop(){ running=false; cancelAnimationFrame(animationFrameId); document.removeEventListener('keydown',keyHandler); }
  function endGame(){ stop(); showGameOver(score); }

  return {start,stop};
}

// -------------------- SPACE INVADERS --------------------
function SpaceInvadersGame(canvas,difficulty){ /* keep existing Space Invaders code */ return {start,stop}; }

</script>
</body>
</html>
