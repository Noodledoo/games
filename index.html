<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Hub</title>
<style>
body { background: #222; color: #fff; font-family: Arial; text-align:center; margin:0; overflow:hidden; }
#menu { margin-top:50px; }
button { padding:15px 30px; margin:10px; font-size:20px; cursor:pointer; }
#gameCanvas { background:black; display:none; margin:20px auto; border:2px solid white; touch-action:none; }
#controls { display:none; margin:20px; }
#overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); color:white; display:none; justify-content:center; align-items:center; flex-direction:column; z-index:10; }
#overlay h2 { font-size:40px; margin-bottom:20px; }
#difficultySelect { margin-top:20px; }
.touch-controls { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); display:none; z-index:20; }
.touch-controls button { padding:20px; margin:5px; font-size:24px; opacity:0.7; }
#snakeSettings { margin-top:20px; display:none; }
</style>
</head>
<body>

<h1>Game Hub</h1>

<div id="menu">
  <button onclick="selectGame('pong')">Play Pong</button>
  <button onclick="selectGame('snake')">Play Snake</button>
  <button onclick="selectGame('space')">Play Space Invaders</button>
  <div id="difficultySelect">
    Difficulty:
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
    </select>
  </div>
</div>

<div id="controls">
  <button onclick="startCurrentGame()">Start</button>
  <button onclick="goBack()">Back</button>
</div>

<div id="snakeSettings">
  <label><input type="checkbox" id="rainbowToggle"> Rainbow Mode</label><br>
  <label><input type="checkbox" id="hunterToggle"> Hunter Mode (2P)</label><br>
  <label>AI Snakes: <span id="aiCountDisplay">1</span></label>
  <button id="aiMinus">-</button>
  <button id="aiPlus">+</button>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="overlay">
  <h2 id="gameOverText">Game Over</h2>
  <p id="finalScore"></p>
  <button onclick="restartGame()">Restart</button>
  <button onclick="exitToMenu()">Return to Menu</button>
</div>

<div class="touch-controls" id="touchControls">
  <button id="btnLeft">◀</button>
  <button id="btnRight">▶</button>
  <button id="btnUp">▲</button>
  <button id="btnDown">▼</button>
  <button id="btnShoot">Fire</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const overlay = document.getElementById('overlay');
const finalScoreText = document.getElementById('finalScore');
const difficultySelect = document.getElementById('difficulty');
const touchControls = document.getElementById('touchControls');
const btnLeft = document.getElementById('btnLeft');
const btnRight = document.getElementById('btnRight');
const btnUp = document.getElementById('btnUp');
const btnDown = document.getElementById('btnDown');
const btnShoot = document.getElementById('btnShoot');

const snakeSettings = document.getElementById('snakeSettings');
const rainbowToggle = document.getElementById('rainbowToggle');
const hunterToggle = document.getElementById('hunterToggle');
const aiCountDisplay = document.getElementById('aiCountDisplay');
const aiMinus = document.getElementById('aiMinus');
const aiPlus = document.getElementById('aiPlus');

let currentGame = null;
let currentGameName = null;

let snakeConfig = { rainbowEnabled:false, hunterMode:false, aiCount:1 };
function updateAICountDisplay(){ aiCountDisplay.innerText = snakeConfig.aiCount; }
aiPlus.onclick = ()=>{ if(snakeConfig.aiCount<50){ snakeConfig.aiCount++; updateAICountDisplay(); } };
aiMinus.onclick = ()=>{ if(snakeConfig.aiCount>0){ snakeConfig.aiCount--; updateAICountDisplay(); } };
rainbowToggle.onchange = ()=>{ snakeConfig.rainbowEnabled = rainbowToggle.checked; };
hunterToggle.onchange = ()=>{ snakeConfig.hunterMode = hunterToggle.checked; };

function selectGame(game){
  document.getElementById('menu').style.display='none';
  document.getElementById('controls').style.display='block';
  canvas.style.display='block';
  currentGameName=game;
  if('ontouchstart' in window){ touchControls.style.display='block'; } else{ touchControls.style.display='none'; }
}

function startCurrentGame(){
  if(currentGame && currentGame.stop) currentGame.stop();
  overlay.style.display='none';
  const difficulty=difficultySelect.value;
  if(currentGameName==='snake'){
    snakeSettings.style.display='block';
    currentGame=SnakeGame(canvas,difficulty,snakeConfig);
    currentGame.start();
  } else {
    snakeSettings.style.display='none';
    if(currentGameName==='pong'){ currentGame=PongGame(canvas,difficulty); currentGame.start(); }
    else if(currentGameName==='space'){ currentGame=SpaceInvadersGame(canvas,difficulty); currentGame.start(); }
  }
}

function goBack(){
  if(currentGame && currentGame.stop) currentGame.stop();
  canvas.style.display='none';
  document.getElementById('controls').style.display='none';
  document.getElementById('menu').style.display='block';
  overlay.style.display='none';
  touchControls.style.display='none';
}

function showGameOver(score){
  overlay.style.display='flex';
  finalScoreText.innerText="Final Score: "+score;
}

function restartGame(){ overlay.style.display='none'; startCurrentGame(); }
function exitToMenu(){ overlay.style.display='none'; goBack(); }

// -------------------- PONG --------------------
function PongGame(canvas,difficulty){
  const ctx=canvas.getContext("2d");
  let paddleHeight = 80, paddleWidth = 10;
  let playerY = canvas.height / 2 - paddleHeight / 2;
  let aiY = playerY;
  let ballSize = 15;
  let ballX = canvas.width / 2;
  let ballY = canvas.height / 2;
  let ballSpeedX = 5, ballSpeedY = 3;
  let playerScore = 0, aiScore = 0;
  let running = false;
  let animationFrameId;
  let keys = {};
  let aiSpeed,paddleSpeed;
  if(difficulty==='easy'){ aiSpeed=3;paddleSpeed=5; }
  else if(difficulty==='medium'){ aiSpeed=4;paddleSpeed=6; }
  else{ aiSpeed=5;paddleSpeed=8; }
  window.addEventListener("keydown", e => keys[e.key] = true);
  window.addEventListener("keyup", e => keys[e.key] = false);

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='white';
    ctx.fillRect(10,playerY,paddleWidth,paddleHeight);
    ctx.fillRect(canvas.width-20,aiY,paddleWidth,paddleHeight);
    ctx.beginPath(); ctx.arc(ballX,ballY,ballSize/2,0,Math.PI*2); ctx.fill();
    ctx.font="20px Arial"; ctx.fillText(playerScore,canvas.width/4,30); ctx.fillText(aiScore,canvas.width*3/4,30);
  }

  function update(){
    if(keys["ArrowUp"]) playerY=Math.max(playerY-paddleSpeed,0);
    if(keys["ArrowDown"]) playerY=Math.min(playerY+paddleSpeed,canvas.height-paddleHeight);
    ballX+=ballSpeedX; ballY+=ballSpeedY;
    if(ballY<=ballSize/2||ballY>=canvas.height-ballSize/2) ballSpeedY*=-1;
    if(ballX-ballSize/2<=20 && ballY>playerY && ballY<playerY+paddleHeight) ballSpeedX*=-1;
    if(ballX+ballSize/2>=canvas.width-20 && ballY>aiY && ballY<aiY+paddleHeight) ballSpeedX*=-1;
    if(ballX<0){ aiScore++; if(aiScore>=5){ endGame(); return; } resetBall(); }
    else if(ballX>canvas.width){ playerScore++; if(playerScore>=5){ endGame(); return; } resetBall(); }
    if(aiY+paddleHeight/2<ballY) aiY+=aiSpeed; else aiY-=aiSpeed;
    aiY=Math.max(0,Math.min(canvas.height-paddleHeight,aiY));
  }

  function resetBall(){ ballX=canvas.width/2; ballY=canvas.height/2; ballSpeedX*=-1; }

  function gameLoop(){ if(!running)return; update(); draw(); animationFrameId=requestAnimationFrame(gameLoop); }
  function endGame(){ stop(); showGameOver(playerScore); }
  function start(){ running=true; gameLoop(); }
  function stop(){ running=false; cancelAnimationFrame(animationFrameId); }

  btnUp.onclick=()=>keys["ArrowUp"]=true; btnUp.onmouseup=btnUp.onmouseleave=()=>keys["ArrowUp"]=false;
  btnDown.onclick=()=>keys["ArrowDown"]=true; btnDown.onmouseup=btnDown.onmouseleave=()=>keys["ArrowDown"]=false;

  return {start,stop};
}

// -------------------- SNAKE --------------------
function SnakeGame(canvas,difficulty,config){
  const ctx=canvas.getContext("2d");
  const blockSize=20;
  const tileCountX=canvas.width/blockSize;
  const tileCountY=canvas.height/blockSize;

  let playerSnake=[{x:5,y:5}];
  let playerDir={x:1,y:0};
  let hunterSnake=null,hunterDir=null;
  let aiSnakes=[],aiDirs=[];
  let food={x:10,y:10};
  let score=0;
  let running=false;
  let animationFrameId;
  let moveTick=0;
  let moveDelay,aiMoveDelay;

  if(difficulty==='easy'){ moveDelay=6; aiMoveDelay=12; }
  else if(difficulty==='medium'){ moveDelay=4; aiMoveDelay=8; }
  else{ moveDelay=2; aiMoveDelay=4; }

  function spawnFood(){
    return { x: Math.floor(Math.random()*tileCountX), y: Math.floor(Math.random()*tileCountY) };
  }

  function randomDir(){ const dirs=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}]; return dirs[Math.floor(Math.random()*4)]; }

  // Spawn AI snakes
  aiSnakes=[]; aiDirs=[];
  for(let i=0;i<config.aiCount;i++){ aiSnakes.push([{x:tileCountX-5-i,y:tileCountY-5}]); aiDirs.push(randomDir()); }

  if(config.hunterMode){ hunterSnake=[{x:tileCountX/2|0,y:tileCountY/2|0}]; hunterDir={x:0,y:1}; }

  function drawBlock(x,y,color){ ctx.fillStyle=color; ctx.fillRect(x*blockSize,y*blockSize,blockSize,blockSize); }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Draw food
    drawBlock(food.x,food.y,'red');
    // Draw player
    for(let i=0;i<playerSnake.length;i++){
      let c=config.rainbowEnabled?`hsl(${(i*30+frameCount*10)%360},100%,50%)`:'lime';
      drawBlock(playerSnake[i].x,playerSnake[i].y,c);
    }
    // Draw hunter
    if(hunterSnake) for(let s of hunterSnake) drawBlock(s.x,s.y,'orange');
    // Draw AI
    for(let sIdx=0;sIdx<aiSnakes.length;sIdx++){
      let s=aiSnakes[sIdx]; for(let t of s) drawBlock(t.x,t.y,'cyan');
    }
  }

  function checkCollision(snake){ let head=snake[0];
    if(head.x<0||head.x>=tileCountX||head.y<0||head.y>=tileCountY) return true;
    for(let i=1;i<snake.length;i++) if(snake[i].x===head.x && snake[i].y===head.y) return true;
    return false;
  }

  function moveSnake(snake,dir){
    let head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};
    snake.unshift(head);
    if(head.x===food.x && head.y===food.y){ score+=10; food=spawnFood(); }
    else snake.pop();
  }

  function aiMove(snake,dir){
    let head=snake[0];
    let dx=food.x-head.x, dy=food.y-head.y;
    let newDir={x:dx!==0?dx/Math.abs(dx):0, y:dy!==0?dy/Math.abs(dy):0};
    return newDir;
  }

  function update(){
    frameCount++;
    moveTick++;
    if(moveTick>=moveDelay){
      moveTick=0;
      // Player
      let nextHead={x:playerSnake[0].x+playerDir.x, y:playerSnake[0].y+playerDir.y};
      // Wall grace: allow 1 frame extra to turn
      if(nextHead.x<0||nextHead.x>=tileCountX||nextHead.y<0||nextHead.y>=tileCountY){
        // do nothing, wait for next move
      } else playerSnake.unshift(nextHead); playerSnake.pop();
      // Check collisions
      if(checkCollision(playerSnake)){ stop(); showGameOver(score); return; }

      // AI snakes
      for(let i=0;i<aiSnakes.length;i++){
        let dir=aiDirs[i];
        if(frameCount%aiMoveDelay===0) dir=aiMove(aiSnakes[i],dir);
        aiDirs[i]=dir;
        moveSnake(aiSnakes[i],dir);
        if(checkCollision(aiSnakes[i])){ aiSnakes[i]=[{x:tileCountX-5-i,y:tileCountY-5}]; aiDirs[i]=randomDir(); }
      }

      // Hunter
      if(hunterSnake) moveSnake(hunterSnake,hunterDir); if(hunterSnake && checkCollision(hunterSnake)) hunterSnake=[{x:tileCountX/2|0,y:tileCountY/2|0}];
    }
  }

  function gameLoop(){
    if(!running) return;
    update();
    draw();
    animationFrameId=requestAnimationFrame(gameLoop);
  }

  // Controls
  let keys={};
  window.addEventListener('keydown', e=>{
    keys[e.key]=true;
    if(e.key==='ArrowUp') playerDir={x:0,y:-1};
    else if(e.key==='ArrowDown') playerDir={x:0,y:1};
    else if(e.key==='ArrowLeft') playerDir={x:-1,y:0};
    else if(e.key==='ArrowRight') playerDir={x:1,y:0};
  });

  btnUp.onclick=()=>playerDir={x:0,y:-1};
  btnDown.onclick=()=>playerDir={x:0,y:1};
  btnLeft.onclick=()=>playerDir={x:-1,y:0};
  btnRight.onclick=()=>playerDir={x:1,y:0};

  function start(){ running=true; gameLoop(); }
  function stop(){ running=false; cancelAnimationFrame(animationFrameId); }

  return {start,stop};
}

// -------------------- SPACE INVADERS (placeholder) --------------------
function SpaceInvadersGame(canvas,difficulty){
  const ctx=canvas.getContext("2d");
  let running=false, animationFrameId, score=0;
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='white';
    ctx.font="30px Arial";
    ctx.fillText("Space Invaders Placeholder",50,canvas.height/2);
  }
  function update(){ score++; }
  function gameLoop(){ if(!running) return; update(); draw(); animationFrameId=requestAnimationFrame(gameLoop); }
  function start(){ running=true; gameLoop(); }
  function stop(){ running=false; cancelAnimationFrame(animationFrameId); }
  return {start,stop};
}
</script>
</body>
</html>
